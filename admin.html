<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê´€ë¦¬ì í˜ì´ì§€</title>
  <link href="https://cdn.jsdelivr.net/npm/water.css@2/out/light.min.css" rel="stylesheet">
</head>
<body>
  <h2>ê´€ë¦¬ì í˜ì´ì§€</h2>

  <section>
    <h3>í™•ì¸ëœ ê´€ë¦¬ì</h3>
    <p id="admin-check" style="color: red;"></p>
  </section>

  <section>
    <h3>íšŒì› ê°œì¸ ì‚­ì œ</h3>
    <input type="number" id="delete-user-id" placeholder="user_id ì…ë ¥">
    <button onclick="deleteUser()">íšŒì› ì‚­ì œ</button>
  </section>
  <section>
    <h3>í•™ìƒ ê¸°ë¡ ì¡°íšŒ</h3>
    <button onclick="location.href='student-records.html'">ğŸ“Š í•™ìƒê¸°ë¡ í˜ì´ì§€ ì´ë™</button>
  </section>
  

  <section>
    <h3>ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”</h3>
    <button onclick="resetAllData()" style="background: red; color: white;">!! ì „ì²´ ì´ˆê¸°í™” !!</button>
  </section>

  <script>
    const api = 'https://supermax.kr/feed';
    const token = localStorage.getItem('token');

    async function deleteUser() {
      const userId = document.getElementById('delete-user-id').value;
      if (!userId) return alert('user_idë¥¼ ì…ë ¥í•˜ì„¸ìš”');

      const confirmed = confirm(`${userId} íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);
      if (!confirmed) return;

      const res = await fetch(`${api}/deleteuser`, {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + token,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ user_id: userId })
      });

      const result = await res.json();
      if (res.ok) alert('íšŒì› ì‚­ì œ ì™„ë£Œ');
      else alert('ì‚­ì œ ì˜¤ë¥˜: ' + result.error);
    }

    async function resetAllData() {
      const confirmed = confirm('ì •ë§ ì „ì²´ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
      if (!confirmed) return;

      const res = await fetch(`${api}/adminreset`, {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + token,
          'Content-Type': 'application/json'
        }
      });

      const result = await res.json();
      if (res.ok) alert('ì´ˆê¸°í™” ì™„ë£Œ');
      else alert('ì˜¤ë¥˜: ' + result.error);
    }

    // ê´€ë¦¬ì ê²€ì‚¬ í…ŒìŠ¤íŠ¸
    (async function checkAdmin() {
      const token = localStorage.getItem('token');
      if (!token) {
        document.getElementById("admin-check").innerText = 'í† í° ì—†ìŒ. ë¡œê·¸ì¸ í•„ìš”';
        return;
      }
      const payload = JSON.parse(atob(token.split('.')[1]));
      if (payload.username === 'admin') {
        document.getElementById("admin-check").innerText = 'ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ë¨';
      } else {
        document.getElementById("admin-check").innerText = 'âŒ ê´€ë¦¬ì ê³„ì •ì´ ì•„ë‹™ë‹ˆë‹¤!';
      }
    })();
  </script>
</body>
</html>
