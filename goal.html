<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ëª©í‘œ ê¸°ë¡ ì„¤ì •</title>
  <link href="https://cdn.jsdelivr.net/npm/water.css@2/out/light.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'SUIT', sans-serif;
      padding-bottom: 80px;
      max-width: 600px;
      margin: auto;
    }
    h2 {
      text-align: center;
      margin-top: 1rem;
    }
    .goal-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
    }
    .goal-row label {
      flex: 1;
      font-weight: 600;
    }
    .goal-row input {
      flex: 2;
      padding: 6px;
    }
    .save-btn {
      width: 100%;
      margin-top: 24px;
    }
  </style>
</head>
<body>
  <h2>ğŸ“Œ ì¢…ëª©ë³„ ëª©í‘œ ê¸°ë¡ ì„¤ì •</h2>

  <form id="goalForm">
    <div class="goal-row">
      <label for="goal-ì œìë¦¬ë©€ë¦¬ë›°ê¸°">ì œìë¦¬ë©€ë¦¬ë›°ê¸° (cm)</label>
      <input type="number" id="goal-ì œìë¦¬ë©€ë¦¬ë›°ê¸°" step="any" placeholder="ì˜ˆ: 250">
    </div>
    <div class="goal-row">
      <label for="goal-ë©”ë””ì‹ ë³¼ë˜ì§€ê¸°">ë©”ë””ì‹ ë³¼ë˜ì§€ê¸° (m)</label>
      <input type="number" id="goal-ë©”ë””ì‹ ë³¼ë˜ì§€ê¸°" step="any">
    </div>
    <div class="goal-row">
      <label for="goal-ë°°ê·¼ë ¥">ë°°ê·¼ë ¥ (Kg)</label>
      <input type="number" id="goal-ë°°ê·¼ë ¥" step="any">
    </div>
    <div class="goal-row">
      <label for="goal-20mì™•ë³µë‹¬ë¦¬ê¸°">20mì™•ë³µë‹¬ë¦¬ê¸° (ì´ˆ)</label>
      <input type="number" id="goal-20mì™•ë³µë‹¬ë¦¬ê¸°" step="any">
    </div>
    <div class="goal-row">
      <label for="goal-ìœ—ëª¸ì¼ìœ¼í‚¤ê¸°">ìœ—ëª¸ì¼ìœ¼í‚¤ê¸° (íšŒ)</label>
      <input type="number" id="goal-ìœ—ëª¸ì¼ìœ¼í‚¤ê¸°" step="any">
    </div>

    <button type="submit" class="save-btn">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
  </form>

  <script>
    const api = 'https://supermax.kr/feed';
    const token = localStorage.getItem('token');
    const headers = {
      'Authorization': 'Bearer ' + token,
      'Content-Type': 'application/json'
    };

    const events = ['ì œìë¦¬ë©€ë¦¬ë›°ê¸°', 'ë©”ë””ì‹ ë³¼ë˜ì§€ê¸°', 'ë°°ê·¼ë ¥', '20mì™•ë³µë‹¬ë¦¬ê¸°', 'ìœ—ëª¸ì¼ìœ¼í‚¤ê¸°'];

    async function fetchGoals() {
      const res = await fetch(`${api}/my-goals`, { headers });
      const data = await res.json();
      data.forEach(g => {
        const input = document.getElementById(`goal-${g.event}`);
        if (input) input.value = g.goal_record;
      });
    }

    async function saveGoals(e) {
      e.preventDefault();
      const goals = events.map(event => {
        const value = parseFloat(document.getElementById(`goal-${event}`).value);
        return isNaN(value) ? null : { event, goal_record: value };
      }).filter(Boolean);

      const res = await fetch(`${api}/update-goals`, {
        method: 'POST',
        headers,
        body: JSON.stringify({ goals })
      });

      if (res.ok) {
        alert("ğŸ‰ ëª©í‘œ ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
        location.href = 'profile-feed.html';
      } else {
        alert("âŒ ì €ì¥ ì‹¤íŒ¨");
      }
    }

    document.getElementById('goalForm').addEventListener('submit', saveGoals);
    fetchGoals();
  </script>
</body>
</html>
